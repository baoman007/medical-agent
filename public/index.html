<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»ç–—é—®è¯Šæ™ºèƒ½ä½“ - AI åŒ»ç–—åŠ©æ‰‹</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .typing-indicator span {
            animation: blink 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes blink {
            0%, 100% {
                opacity: 0.2;
            }
            50% {
                opacity: 1;
            }
        }
        .symptom-tag {
            transition: all 0.2s ease;
        }
        .symptom-tag:hover {
            transform: translateY(-2px);
        }
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- å¤´éƒ¨ -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="bg-white/20 p-3 rounded-xl backdrop-blur">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">åŒ»ç–—é—®è¯Šæ™ºèƒ½ä½“</h1>
                        <p class="text-white/80 text-sm">AI åŒ»ç–—åŠ©æ‰‹ Â· åˆæ­¥è¯Šæ–­ä¸å¥åº·å»ºè®®</p>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-4 text-sm">
                    <span class="bg-white/20 px-3 py-1 rounded-full">åŸºäº LangChain + DeepSeek</span>
                </div>
            </div>
        </div>
    </header>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="container mx-auto px-4 py-8 max-w-7xl">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦ä¾§ï¼šè¾“å…¥åŒºåŸŸ -->
            <div class="lg:col-span-1 space-y-6">
                <!-- å¿«æ·ç—‡çŠ¶ -->
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        å¸¸è§ç—‡çŠ¶
                    </h2>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="addSymptom('å¤´ç—›')" class="symptom-tag px-3 py-1.5 bg-purple-50 text-purple-700 rounded-lg text-sm font-medium hover:bg-purple-100">å¤´ç—›</button>
                        <button onclick="addSymptom('å‘çƒ§')" class="symptom-tag px-3 py-1.5 bg-blue-50 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-100">å‘çƒ§</button>
                        <button onclick="addSymptom('å’³å—½')" class="symptom-tag px-3 py-1.5 bg-green-50 text-green-700 rounded-lg text-sm font-medium hover:bg-green-100">å’³å—½</button>
                        <button onclick="addSymptom('æ¶å¿ƒ')" class="symptom-tag px-3 py-1.5 bg-yellow-50 text-yellow-700 rounded-lg text-sm font-medium hover:bg-yellow-100">æ¶å¿ƒ</button>
                        <button onclick="addSymptom('èƒ¸ç—›')" class="symptom-tag px-3 py-1.5 bg-red-50 text-red-700 rounded-lg text-sm font-medium hover:bg-red-100">èƒ¸ç—›</button>
                        <button onclick="addSymptom('å‘¼å¸å›°éš¾')" class="symptom-tag px-3 py-1.5 bg-orange-50 text-orange-700 rounded-lg text-sm font-medium hover:bg-orange-100">å‘¼å¸å›°éš¾</button>
                        <button onclick="addSymptom('ä¹åŠ›')" class="symptom-tag px-3 py-1.5 bg-gray-50 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-100">ä¹åŠ›</button>
                        <button onclick="addSymptom('è…¹æ³»')" class="symptom-tag px-3 py-1.5 bg-indigo-50 text-indigo-700 rounded-lg text-sm font-medium hover:bg-indigo-100">è…¹æ³»</button>
                    </div>
                </div>

                <!-- è¾“å…¥æ¡† -->
                <div class="bg-white rounded-2xl shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        æè¿°æ‚¨çš„ç—‡çŠ¶
                    </h2>
                    <textarea
                        id="symptomInput"
                        rows="6"
                        class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none text-gray-700 placeholder-gray-400 transition-all"
                        placeholder="è¯·è¯¦ç»†æè¿°æ‚¨çš„ç—‡çŠ¶ï¼Œä¾‹å¦‚ï¼š&#10;- æœ‰ä»€ä¹ˆä¸é€‚ï¼Ÿ&#10;- ç—‡çŠ¶æŒç»­å¤šä¹…äº†ï¼Ÿ&#10;- æœ‰å…¶ä»–ä¼´éšç—‡çŠ¶å—ï¼Ÿ"
                    ></textarea>
                    <button
                        onclick="submitConsultation()"
                        id="submitBtn"
                        class="w-full mt-4 bg-gradient-to-r from-purple-600 to-blue-600 text-white py-3 px-6 rounded-xl font-semibold hover:from-purple-700 hover:to-blue-700 transition-all transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center space-x-2 shadow-lg shadow-purple-200"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                        </svg>
                        <span>å¼€å§‹é—®è¯Š</span>
                    </button>
                </div>

                <!-- å¥åº·æç¤º -->
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 border border-amber-200 rounded-2xl p-6">
                    <div class="flex items-start space-x-3">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-amber-600 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <div>
                            <h3 class="font-semibold text-amber-800 mb-2">é‡è¦æç¤º</h3>
                            <p class="text-sm text-amber-700">
                                æœ¬ç³»ç»Ÿæä¾›çš„ä¿¡æ¯ä»…ä¾›å‚è€ƒï¼Œä¸èƒ½æ›¿ä»£ä¸“ä¸šåŒ»ç”Ÿçš„è¯Šæ–­å’Œæ²»ç–—ã€‚ç´§æ€¥æƒ…å†µè¯·ç«‹å³å°±åŒ»æˆ–æ‹¨æ‰“æ€¥æ•‘ç”µè¯ï¼ˆ120ï¼‰ã€‚
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“æœå±•ç¤ºåŒº -->
            <div class="lg:col-span-2 space-y-6">
                <!-- ç»“æœå¡ç‰‡ -->
                <div id="resultContainer" class="bg-white rounded-2xl shadow-sm p-6 min-h-[600px]">
                    <h2 class="text-lg font-semibold text-gray-800 mb-6 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                        è¯Šæ–­ç»“æœ
                    </h2>

                    <!-- åˆå§‹çŠ¶æ€ -->
                    <div id="initialState" class="flex flex-col items-center justify-center h-96 text-center">
                        <div class="bg-purple-50 p-6 rounded-full mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                        </div>
                        <p class="text-gray-500 text-lg mb-2">ç­‰å¾…é—®è¯Š</p>
                        <p class="text-gray-400 text-sm">è¯·æè¿°æ‚¨çš„ç—‡çŠ¶ï¼ŒAI åŒ»ç–—åŠ©æ‰‹å°†ä¸ºæ‚¨æä¾›åˆæ­¥è¯Šæ–­å’Œå»ºè®®</p>
                    </div>

                    <!-- åŠ è½½çŠ¶æ€ -->
                    <div id="loadingState" class="hidden">
                        <div class="flex items-center justify-center h-96">
                            <div class="text-center">
                                <div class="typing-indicator flex space-x-2 justify-center mb-4">
                                    <span class="w-3 h-3 bg-purple-600 rounded-full"></span>
                                    <span class="w-3 h-3 bg-purple-600 rounded-full"></span>
                                    <span class="w-3 h-3 bg-purple-600 rounded-full"></span>
                                </div>
                                <p class="text-gray-600 font-medium">AI åŒ»ç–—åŠ©æ‰‹æ­£åœ¨åˆ†ææ‚¨çš„ç—‡çŠ¶...</p>
                            </div>
                        </div>
                    </div>

                    <!-- ç»“æœå†…å®¹ -->
                    <div id="resultContent" class="hidden space-y-4">
                        <!-- ç´§æ€¥ç¨‹åº¦ -->
                        <div id="urgencySection"></div>

                        <!-- è¯Šæ–­ç»“æœ -->
                        <div id="diagnosisSection" class="hidden">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                                </svg>
                                åˆæ­¥è¯Šæ–­
                            </h3>
                            <div class="bg-blue-50 border border-blue-200 rounded-xl p-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span id="diagnosisName" class="text-xl font-bold text-blue-900"></span>
                                    <span id="diagnosisConfidence" class="px-3 py-1 bg-blue-600 text-white rounded-full text-sm font-semibold"></span>
                                </div>
                                <p id="diagnosisReasoning" class="text-sm text-blue-800"></p>
                            </div>
                        </div>

                        <!-- è¯¦ç»†å»ºè®® -->
                        <div id="recommendationSection" class="hidden">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                æŠ¤ç†å»ºè®®
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div id="selfCareCard" class="bg-green-50 border border-green-200 rounded-xl p-4">
                                    <h4 class="font-semibold text-green-800 mb-2">è‡ªæˆ‘æŠ¤ç†</h4>
                                    <ul id="selfCareList" class="text-sm text-green-700 space-y-1"></ul>
                                </div>
                                <div id="lifestyleCard" class="bg-purple-50 border border-purple-200 rounded-xl p-4">
                                    <h4 class="font-semibold text-purple-800 mb-2">ç”Ÿæ´»æ–¹å¼</h4>
                                    <ul id="lifestyleList" class="text-sm text-purple-700 space-y-1"></ul>
                                </div>
                            </div>
                        </div>

                        <!-- è¯¦ç»†å›å¤ -->
                        <div id="fullResponseSection" class="hidden">
                            <h3 class="font-semibold text-gray-800 mb-3 flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                                è¯¦ç»†è¯´æ˜
                            </h3>
                            <div id="fullResponse" class="bg-gray-50 border border-gray-200 rounded-xl p-4 text-sm text-gray-700 whitespace-pre-wrap leading-relaxed"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        let consultationHistory = [];

        // æ·»åŠ ç—‡çŠ¶åˆ°è¾“å…¥æ¡†
        function addSymptom(symptom) {
            const input = document.getElementById('symptomInput');
            const currentText = input.value.trim();
            if (currentText) {
                input.value = currentText + 'ã€' + symptom;
            } else {
                input.value = symptom;
            }
            input.focus();
        }

        // æäº¤é—®è¯Š
        async function submitConsultation() {
            const input = document.getElementById('symptomInput');
            const message = input.value.trim();

            if (!message) {
                alert('è¯·æè¿°æ‚¨çš„ç—‡çŠ¶');
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('initialState').classList.add('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');

            // ç¦ç”¨æäº¤æŒ‰é’®
            const submitBtn = document.getElementById('submitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="animate-spin mr-2">âŸ³</span> åˆ†æä¸­...';

            try {
                const response = await fetch('/api/consult', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });

                const result = await response.json();

                if (result.success) {
                    displayResult(result);
                    addToHistory(message, result);
                } else {
                    throw new Error(result.error || 'å¤„ç†å¤±è´¥');
                }
            } catch (error) {
                alert('é—®è¯Šå¤±è´¥: ' + error.message);
                document.getElementById('initialState').classList.remove('hidden');
            } finally {
                // æ¢å¤æäº¤æŒ‰é’®
                submitBtn.disabled = false;
                submitBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                    </svg>
                    <span>å¼€å§‹é—®è¯Š</span>
                `;
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function displayResult(result) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('hidden');

            // ç´§æ€¥ç¨‹åº¦
            const urgency = result.urgency || 'unknown';
            const urgencySection = document.getElementById('urgencySection');
            const urgencyConfig = {
                emergency: {
                    bg: 'bg-red-50',
                    border: 'border-red-200',
                    text: 'text-red-800',
                    icon: 'ğŸš¨',
                    label: 'ç´§æ€¥'
                },
                high: {
                    bg: 'bg-orange-50',
                    border: 'border-orange-200',
                    text: 'text-orange-800',
                    icon: 'âš ï¸',
                    label: 'é«˜åº¦å…³æ³¨'
                },
                medium: {
                    bg: 'bg-yellow-50',
                    border: 'border-yellow-200',
                    text: 'text-yellow-800',
                    icon: 'âš¡',
                    label: 'ä¸­ç­‰'
                },
                low: {
                    bg: 'bg-green-50',
                    border: 'border-green-200',
                    text: 'text-green-800',
                    icon: 'âœ“',
                    label: 'è½»å¾®'
                }
            };
            const config = urgencyConfig[urgency] || urgencyConfig.low;
            urgencySection.className = `p-4 rounded-xl border ${config.bg} ${config.border}`;
            urgencySection.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-2">
                        <span class="text-2xl">${config.icon}</span>
                        <span class="font-semibold ${config.text}">ç´§æ€¥ç¨‹åº¦ï¼š${config.label}</span>
                    </div>
                </div>
            `;

            // è¯Šæ–­ç»“æœ
            if (result.diagnosis) {
                document.getElementById('diagnosisSection').classList.remove('hidden');
                document.getElementById('diagnosisName').textContent = result.diagnosis.mostLikely || 'æš‚æ— æ³•ç¡®å®š';
                document.getElementById('diagnosisConfidence').textContent = `ç½®ä¿¡åº¦ ${result.diagnosis.confidence || 0}%`;
                document.getElementById('diagnosisReasoning').textContent = result.diagnosis.reasoning || '';
            }

            // æŠ¤ç†å»ºè®®
            if (result.recommendations) {
                document.getElementById('recommendationSection').classList.remove('hidden');

                // è‡ªæˆ‘æŠ¤ç†
                const selfCareList = document.getElementById('selfCareList');
                selfCareList.innerHTML = (result.recommendations.selfCare || []).map(item =>
                    `<li class="flex items-start"><span class="mr-2">â€¢</span>${item}</li>`
                ).join('');

                // ç”Ÿæ´»æ–¹å¼
                const lifestyleList = document.getElementById('lifestyleList');
                lifestyleList.innerHTML = (result.recommendations.lifestyle || []).map(item =>
                    `<li class="flex items-start"><span class="mr-2">â€¢</span>${item}</li>`
                ).join('');
            }

            // è¯¦ç»†å›å¤
            if (result.content) {
                document.getElementById('fullResponseSection').classList.remove('hidden');
                document.getElementById('fullResponse').textContent = result.content;
            }
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(message, result) {
            consultationHistory.unshift({
                message,
                result,
                timestamp: new Date().toLocaleString()
            });
        }
    </script>
</body>
</html>
